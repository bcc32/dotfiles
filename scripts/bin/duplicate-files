#!/usr/bin/env bash

set -euo pipefail

digests_file=$(mktemp)
duplicates_file=$(mktemp)

echo >&2 'digesting...'

find . -type f |
    parallel --bar -X md5sum |
    sort \
        > "$digests_file"

echo >&2 'digesting... done'

sed 's/  /\t/' "$digests_file" |
    cut -f 1 |
    uniq -d \
         > "$duplicates_file"

join "$duplicates_file" "$digests_file"
